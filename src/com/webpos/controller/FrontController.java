package com.webpos.controller;import java.util.List;import javax.annotation.Resource;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import org.apache.log4j.Logger;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.servlet.ModelAndView;import com.webpos.dao.SystemMapper;import com.webpos.entity.Award;import com.webpos.service.AccountService;import com.webpos.service.AwardService;import com.webpos.service.DetailsService;import com.webpos.service.UserService;import com.webpos.tools.CommUtil;import com.webpos.tools.JModelAndView;@Controllerpublic class FrontController extends ApiWebABaseController {	private Logger log = Logger.getLogger(getClass());	@Autowired	private UserService userService;	@Autowired	private AccountService accountService;	@Autowired	private DetailsService detailService;	@Autowired	private AwardService awardService;	@Resource	private SystemMapper systemDao;	@RequestMapping({ "/login.do" })	public ModelAndView login(HttpServletRequest request, HttpSession httpSession, Model model,			HttpServletResponse response) {		String parent = request.getParameter("parent");		String time = "" + System.currentTimeMillis();		httpSession.setAttribute("localtime", time);		httpSession.setAttribute("parent", parent);		ModelAndView mv = new JModelAndView("pos/front/login", 0, request, response);		CommUtil.addIPageList2ModelAndView1("", "", "", null, mv);		return mv;	}	@RequestMapping({ "/index.do" })	public ModelAndView index(HttpServletRequest request, HttpSession httpSession, Model model,			HttpServletResponse response) {		if (!super.isLogin()) {			return new ModelAndView("redirect:/login.do");		}		Award award = awardService.getLast();		String nextname =CommUtil.getNextQi(award.getName());				ModelAndView mv = new JModelAndView("pos/front/index", 0, request, response);		int nextsecond = CommUtil.getSecondFromQi(nextname);		mv.addObject("award",award);		mv.addObject("nextname",nextname);		mv.addObject("nextsecond",nextsecond);		CommUtil.addIPageList2ModelAndView1("", "", "", null, mv);		return mv;	}		/**	 * 开奖信息页面	 * @param request	 * @param httpSession	 * @param model	 * @param response	 * @return	 */	@RequestMapping({ "/kj.do" })	public ModelAndView kj(HttpServletRequest request, HttpSession httpSession, Model model,			HttpServletResponse response) {		if (!super.isLogin()) {			return new ModelAndView("redirect:/login.do");		}		Award award = awardService.getLast();		List<Award> awards = awardService.getLastList();		String nextname =CommUtil.getNextQi(award.getName());				ModelAndView mv = new JModelAndView("pos/front/kaijiang", 0, request, response);		int nextsecond = CommUtil.getSecondFromQi(nextname);		mv.addObject("award",award);		mv.addObject("awards",awards);		mv.addObject("nextname",nextname);		mv.addObject("nextsecond",nextsecond);		CommUtil.addIPageList2ModelAndView1("", "", "", null, mv);		return mv;	}	@RequestMapping({ "/room.do" })	public ModelAndView room(HttpServletRequest request, HttpSession httpSession, Model model,			HttpServletResponse response) {		if (!super.isLogin()) {			return new ModelAndView("redirect:/login.do");		}		String roomid = request.getParameter("roomid");		String userid = super.getLoginUser().getUser_id();		String time = "" + System.currentTimeMillis();		httpSession.setAttribute("localtime", time);		ModelAndView mv = new JModelAndView("pos/front/room", 0, request, response);		mv.addObject("roomid", "" + roomid);		mv.addObject("userid", "" + userid);		CommUtil.addIPageList2ModelAndView1("", "", "", null, mv);		return mv;	}}
